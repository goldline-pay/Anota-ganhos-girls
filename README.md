# üí∞ Anota Ganhos Girls

Sistema completo de tracking de ganhos para profissionais, com autentica√ß√£o JWT, banco de dados MySQL, estat√≠sticas semanais, per√≠odos de "top" e painel administrativo.

## üöÄ Funcionalidades

- ‚úÖ **Autentica√ß√£o completa** com JWT e bcrypt
- ‚úÖ **Registro de ganhos** em m√∫ltiplas moedas (GBP, EUR, USD)
- ‚úÖ **Estat√≠sticas semanais** autom√°ticas
- ‚úÖ **Sistema de "Top"** com per√≠odos de 7 dias
- ‚úÖ **Painel administrativo** para gerenciar usu√°rios e anota√ß√µes
- ‚úÖ **Conta admin padr√£o** criada automaticamente
- ‚úÖ **API RESTful** completa e segura
- ‚úÖ **Banco de dados MySQL** com schema otimizado
- ‚úÖ **Pronto para deploy** no Render e Railway

## üîê Credenciais Admin Padr√£o

```
Email: admin@anotaganhos.com
Senha: Admin123!
```

**‚ö†Ô∏è IMPORTANTE: Altere a senha ap√≥s o primeiro login em produ√ß√£o!**

## üìã Pr√©-requisitos

- Node.js 18+ 
- MySQL 8.0+
- npm ou yarn

## üõ†Ô∏è Instala√ß√£o Local

### 1. Clone o reposit√≥rio

```bash
git clone https://github.com/goldline-pay/Anota-ganhos-girls.git
cd Anota-ganhos-girls
```

### 2. Instale as depend√™ncias

```bash
npm install
```

### 3. Configure o banco de dados

Crie o banco de dados MySQL:

```bash
mysql -u root -p < schema.sql
```

Ou manualmente:

```sql
CREATE DATABASE anota_ganhos_girls CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 4. Configure as vari√°veis de ambiente

Copie o arquivo `.env.example` para `.env`:

```bash
cp .env.example .env
```

Edite o arquivo `.env` com suas configura√ß√µes:

```env
PORT=3000
NODE_ENV=production
JWT_SECRET=sua_chave_secreta_super_segura_aqui
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=sua_senha_mysql
DB_NAME=anota_ganhos_girls
```

### 5. Inicie o servidor

```bash
npm start
```

O servidor estar√° rodando em `http://localhost:3000`

## üåê Deploy no Render

### Passo 1: Criar o banco de dados MySQL

1. Acesse [Render Dashboard](https://dashboard.render.com/)
2. Clique em **"New +"** ‚Üí **"MySQL"**
3. Configure:
   - **Name**: `anota-ganhos-db`
   - **Database**: `anota_ganhos_girls`
   - **User**: `root`
   - **Region**: escolha a mais pr√≥xima
4. Clique em **"Create Database"**
5. **IMPORTANTE**: Anote as credenciais:
   - Internal Database URL
   - Host
   - Port
   - Database
   - Username
   - Password

### Passo 2: Criar o Web Service

1. No Render Dashboard, clique em **"New +"** ‚Üí **"Web Service"**
2. Conecte seu reposit√≥rio GitHub: `goldline-pay/Anota-ganhos-girls`
3. Configure:
   - **Name**: `anota-ganhos-girls`
   - **Environment**: `Node`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: Free (ou escolha outro)

### Passo 3: Configurar vari√°veis de ambiente

Adicione as seguintes vari√°veis de ambiente no Render:

```
NODE_ENV=production
PORT=3000
JWT_SECRET=<gere_uma_chave_segura_aleatoria_aqui>
DB_HOST=<host_do_mysql_interno_do_render>
DB_PORT=3306
DB_USER=root
DB_PASSWORD=<senha_do_mysql_do_render>
DB_NAME=anota_ganhos_girls
```

**Como obter as credenciais do MySQL:**
- V√° at√© o servi√ßo MySQL que voc√™ criou
- Clique em **"Connect"**
- Copie o **Internal Database URL** ou as credenciais individuais
- Use o **Internal Host** (n√£o o External!)

**Para gerar JWT_SECRET seguro:**
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### Passo 4: Deploy

1. Clique em **"Create Web Service"**
2. Aguarde o deploy (pode levar 2-5 minutos)
3. Verifique os logs para confirmar que o servidor iniciou
4. Acesse a URL fornecida pelo Render (ex: `https://anota-ganhos-girls.onrender.com`)

### Passo 5: Verificar funcionamento

1. Acesse a URL do seu app
2. Fa√ßa login com as credenciais admin: `admin@anotaganhos.com` / `Admin123!`
3. Teste criar uma anota√ß√£o
4. **Altere a senha do admin imediatamente!**

## üöÇ Deploy no Railway

### Passo 1: Criar novo projeto

1. Acesse [Railway Dashboard](https://railway.app/dashboard)
2. Clique em **"New Project"**
3. Selecione **"Deploy from GitHub repo"**
4. Escolha o reposit√≥rio `goldline-pay/Anota-ganhos-girls`
5. Clique em **"Deploy Now"**

### Passo 2: Adicionar banco de dados MySQL

1. No projeto, clique em **"+ New"**
2. Selecione **"Database"** ‚Üí **"Add MySQL"**
3. O Railway criar√° automaticamente o banco de dados
4. Aguarde a cria√ß√£o (aparecer√° um container MySQL)

### Passo 3: Configurar vari√°veis de ambiente

1. Clique no servi√ßo da aplica√ß√£o (n√£o no MySQL)
2. V√° em **"Variables"** (aba superior)
3. Clique em **"+ New Variable"**
4. Adicione as seguintes vari√°veis:

```
NODE_ENV=production
PORT=3000
JWT_SECRET=<gere_uma_chave_segura_aleatoria>
DB_HOST=${{MySQL.MYSQLHOST}}
DB_PORT=${{MySQL.MYSQLPORT}}
DB_USER=${{MySQL.MYSQLUSER}}
DB_PASSWORD=${{MySQL.MYSQLPASSWORD}}
DB_NAME=${{MySQL.MYSQLDATABASE}}
```

**Nota importante sobre Railway:**
- As vari√°veis `${{MySQL.VARIAVEL}}` s√£o **refer√™ncias autom√°ticas** do Railway
- Digite exatamente como mostrado acima (com `${{` e `}}`)
- O Railway substituir√° automaticamente pelos valores corretos do MySQL

**Para gerar JWT_SECRET:**
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### Passo 4: Gerar dom√≠nio p√∫blico

1. Clique no servi√ßo da aplica√ß√£o
2. V√° em **"Settings"** (aba superior)
3. Role at√© **"Networking"**
4. Clique em **"Generate Domain"**
5. Copie a URL gerada (ex: `https://anota-ganhos-girls-production.up.railway.app`)

### Passo 5: Redeploy (se necess√°rio)

1. Se o deploy falhou antes de adicionar as vari√°veis:
2. Clique nos 3 pontinhos do servi√ßo
3. Clique em **"Redeploy"**
4. Aguarde o novo deploy

### Passo 6: Verificar funcionamento

1. Acesse a URL gerada
2. Fa√ßa login com: `admin@anotaganhos.com` / `Admin123!`
3. Teste criar uma anota√ß√£o
4. **Altere a senha do admin!**

## üì° API Endpoints

### Autentica√ß√£o

- `POST /api/auth/register` - Registrar novo usu√°rio
  ```json
  {
    "email": "user@example.com",
    "name": "Nome do Usu√°rio",
    "password": "senha123"
  }
  ```

- `POST /api/auth/login` - Fazer login
  ```json
  {
    "email": "user@example.com",
    "password": "senha123"
  }
  ```

- `GET /api/auth/me` - Obter usu√°rio atual (requer token)
  - Header: `Authorization: Bearer <token>`

### Anota√ß√µes de Ganhos

- `GET /api/earnings` - Listar anota√ß√µes do usu√°rio (requer token)
- `POST /api/earnings` - Criar nova anota√ß√£o (requer token)
  ```json
  {
    "amount": 150.50,
    "currency": "EUR",
    "durationMinutes": 60,
    "description": "Sess√£o de trabalho",
    "date": "2024-10-26",
    "paymentMethod": "Cash"
  }
  ```

- `PUT /api/earnings/:id` - Editar anota√ß√£o (requer token)
- `DELETE /api/earnings/:id` - Deletar anota√ß√£o (requer token)

### Estat√≠sticas

- `GET /api/stats/weekly` - Obter estat√≠sticas semanais (requer token)

### Top Periods

- `POST /api/top/start` - Iniciar novo per√≠odo de top (requer token)
- `POST /api/top/set-day` - Definir dia atual do top (requer token)
  ```json
  {
    "day": 3
  }
  ```
- `POST /api/top/stop` - Parar top ativo (requer token)
- `GET /api/top/current` - Obter top ativo (requer token)
- `GET /api/top/history` - Hist√≥rico de tops (requer token)

### Admin (requer role admin)

- `GET /api/admin/users` - Listar todos os usu√°rios
- `GET /api/admin/earnings/:userId` - Listar anota√ß√µes de um usu√°rio
- `PUT /api/admin/earnings/:id` - Editar anota√ß√£o de qualquer usu√°rio
- `DELETE /api/admin/earnings/:id` - Deletar anota√ß√£o de qualquer usu√°rio

## üîí Seguran√ßa

- ‚úÖ Senhas hasheadas com bcrypt (salt rounds: 10)
- ‚úÖ Autentica√ß√£o JWT com expira√ß√£o de 7 dias
- ‚úÖ Prote√ß√£o contra SQL Injection (prepared statements)
- ‚úÖ CORS configurado
- ‚úÖ Valida√ß√£o de dados em todas as rotas
- ‚úÖ Middleware de autentica√ß√£o e autoriza√ß√£o
- ‚úÖ Foreign keys com ON DELETE CASCADE
- ‚úÖ √çndices otimizados no banco

## üóÑÔ∏è Estrutura do Banco de Dados

### Tabela `users`
```sql
id VARCHAR(64) PRIMARY KEY
email VARCHAR(320) UNIQUE NOT NULL
passwordHash VARCHAR(255)
name TEXT
role ENUM('user', 'admin') DEFAULT 'user'
createdAt TIMESTAMP
lastSignedIn TIMESTAMP
```

### Tabela `earnings`
```sql
id VARCHAR(64) PRIMARY KEY
userId VARCHAR(64) FOREIGN KEY
gbpAmount INT (em centavos)
eurAmount INT (em centavos)
usdAmount INT (em centavos)
durationMinutes INT
description TEXT
date DATE
paymentMethod VARCHAR(50)
createdAt TIMESTAMP
updatedAt TIMESTAMP
```

### Tabela `weeklyStats`
```sql
id VARCHAR(64) PRIMARY KEY
userId VARCHAR(64) FOREIGN KEY
weekStartDate DATE
totalGbpAmount INT
totalEurAmount INT
totalUsdAmount INT
totalDurationMinutes INT
totalEarnings INT
updatedAt TIMESTAMP
UNIQUE(userId, weekStartDate)
```

### Tabela `topPeriods`
```sql
id VARCHAR(64) PRIMARY KEY
userId VARCHAR(64) FOREIGN KEY
startDate DATETIME
endDate DATETIME
currentDay INT (1-7)
totalGbpAmount INT
totalEurAmount INT
totalUsdAmount INT
status ENUM('active', 'stopped', 'completed')
createdAt TIMESTAMP
updatedAt TIMESTAMP
```

## üêõ Troubleshooting

### Erro de conex√£o com MySQL no Render/Railway

**Problema:** `Error: connect ECONNREFUSED` ou `ER_ACCESS_DENIED_ERROR`

**Solu√ß√£o:**
1. Verifique se o banco MySQL est√° rodando (veja o status no dashboard)
2. Confirme que est√° usando o **Internal Host** (n√£o External)
3. Verifique se todas as vari√°veis de ambiente est√£o corretas
4. No Railway, use as refer√™ncias `${{MySQL.VARIAVEL}}`
5. Aguarde alguns minutos ap√≥s criar o MySQL (pode demorar para inicializar)
6. Tente fazer redeploy da aplica√ß√£o

### Erro "Token inv√°lido"

**Problema:** API retorna 403 Forbidden

**Solu√ß√£o:**
1. Verifique se o `JWT_SECRET` est√° configurado nas vari√°veis de ambiente
2. Certifique-se de enviar o token no header: `Authorization: Bearer <token>`
3. O token expira em 7 dias - fa√ßa login novamente
4. Limpe o cache do navegador

### Servidor n√£o inicia

**Problema:** Deploy falha ou servidor n√£o responde

**Solu√ß√£o:**
1. Verifique os logs no dashboard (Render ou Railway)
2. Confirme que todas as vari√°veis de ambiente est√£o definidas
3. Verifique se o `PORT` est√° definido (Railway usa vari√°vel autom√°tica)
4. Execute `npm install` localmente para verificar depend√™ncias
5. Verifique se o `package.json` tem `"type": "module"`

### Admin n√£o consegue fazer login

**Problema:** "Email ou senha inv√°lidos"

**Solu√ß√£o:**
1. O usu√°rio admin √© criado automaticamente na primeira inicializa√ß√£o
2. Aguarde o servidor inicializar completamente (veja os logs)
3. Procure a mensagem "‚úÖ Usu√°rio admin criado" nos logs
4. Use exatamente: `admin@anotaganhos.com` / `Admin123!`
5. Se n√£o funcionar, conecte ao MySQL e verifique a tabela `users`

### Banco de dados vazio ap√≥s deploy

**Problema:** Tabelas n√£o foram criadas

**Solu√ß√£o:**
1. O servidor cria as tabelas automaticamente ao iniciar
2. Verifique os logs para a mensagem "‚úÖ Banco de dados inicializado"
3. Se n√£o aparecer, pode haver erro de conex√£o com MySQL
4. Voc√™ pode executar manualmente o `schema.sql` no MySQL:
   - Render: use o console do MySQL no dashboard
   - Railway: use o cliente MySQL ou Railway CLI

## üìä Monitoramento

### Logs no Render
1. V√° at√© o servi√ßo
2. Clique em **"Logs"** (aba superior)
3. Veja logs em tempo real

### Logs no Railway
1. V√° at√© o servi√ßo
2. Clique em **"Deployments"**
3. Clique no deployment ativo
4. Veja logs em tempo real

### Mensagens importantes nos logs
- `‚úÖ Banco de dados inicializado com sucesso!` - DB OK
- `‚úÖ Usu√°rio admin criado` - Admin criado
- `üöÄ Servidor rodando em http://localhost:3000` - Servidor OK
- `‚ùå Erro ao inicializar banco de dados` - Problema no MySQL

## üîÑ Atualiza√ß√µes

### Atualizar c√≥digo no Render
1. Fa√ßa push para o GitHub
2. O Render far√° deploy autom√°tico
3. Ou clique em **"Manual Deploy"** ‚Üí **"Deploy latest commit"**

### Atualizar c√≥digo no Railway
1. Fa√ßa push para o GitHub
2. O Railway far√° deploy autom√°tico
3. Ou clique em **"Redeploy"** no menu do servi√ßo

## üìù Notas Importantes

1. **Valores monet√°rios**: Armazenados em centavos (multiply por 100 ao salvar, divide por 100 ao exibir)
2. **Datas**: Use formato ISO 8601 (`YYYY-MM-DD`)
3. **JWT**: Tokens expiram em 7 dias
4. **Senhas**: M√≠nimo recomendado de 8 caracteres
5. **Admin**: Apenas um admin por padr√£o, crie mais via banco se necess√°rio
6. **CORS**: Configurado para aceitar todas as origens (ajuste em produ√ß√£o se necess√°rio)

## üéØ Pr√≥ximos Passos Recomendados

1. ‚úÖ Deploy no Render ou Railway
2. ‚úÖ Testar todas as funcionalidades
3. ‚úÖ Alterar senha do admin
4. ‚è≥ Configurar dom√≠nio personalizado
5. ‚è≥ Configurar backup autom√°tico do MySQL
6. ‚è≥ Adicionar monitoramento (Sentry, LogRocket, etc.)
7. ‚è≥ Implementar rate limiting
8. ‚è≥ Adicionar testes automatizados

## üìû Suporte

Para problemas ou d√∫vidas:
1. Verifique a se√ß√£o **Troubleshooting** acima
2. Consulte os logs do servidor
3. Abra uma issue no GitHub
4. Entre em contato com a equipe de desenvolvimento

---

**Desenvolvido com ‚ù§Ô∏è para Anota Ganhos Girls**

**Vers√£o:** 2.0.0  
**√öltima atualiza√ß√£o:** Outubro 2024

